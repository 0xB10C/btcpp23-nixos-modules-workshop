{
  "name": "nixos-modules-workshop",

  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
  
  "features": {
    "ghcr.io/devcontainers/features/nix:1": {
      "packages": [ "nixos-shell", "qemu" ]
    }
  },

  "hostRequirements": {
    "cpus": 4
  },

  "onCreateCommand": {
    "fix nix permissions": "sudo apt install acl; sudo setfacl -k /tmp",
    "try running nixos-shell once": "nixos-shell --verbose || true"
  },

  "postAttachCommand": "sudo setfacl -k /tmp && nixos-shell --verbose"
}
